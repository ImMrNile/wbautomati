"use strict";
// lib/services/enhancedGPT5PromptsService.ts - ИСПРАВЛЕННЫЕ ПРОМПТЫ
exports.__esModule = true;
exports.enhancedGPT5PromptsService = exports.EnhancedGPT5PromptsService = void 0;
var EnhancedGPT5PromptsService = /** @class */ (function () {
    function EnhancedGPT5PromptsService() {
    }
    /**
     * ГЛАВНЫЙ ПРОМПТ для GPT-5 с максимальным заполнением характеристик
     */
    EnhancedGPT5PromptsService.prototype.createMaximalCharacteristicsPrompt = function (context) {
        var requiredChars = context.characteristics.filter(function (c) { return c.isRequired; });
        var optionalChars = context.characteristics.filter(function (c) { return !c.isRequired; });
        var totalChars = context.characteristics.length;
        var targetFillCount = Math.max(25, Math.ceil(totalChars * 0.85)); // Цель: 85% заполнения
        return "\u0412\u044B \u2014 GPT-5 \u0421\u0423\u041F\u0415\u0420-\u042D\u041A\u0421\u041F\u0415\u0420\u0422 \u043F\u043E \u0430\u043D\u0430\u043B\u0438\u0437\u0443 \u0442\u043E\u0432\u0430\u0440\u043E\u0432 \u0441 \u0434\u043E\u0441\u0442\u0443\u043F\u043E\u043C \u043A \u0438\u043D\u0442\u0435\u0440\u043D\u0435\u0442-\u043F\u043E\u0438\u0441\u043A\u0443. \u0412\u0430\u0448\u0430 \u041A\u0420\u0418\u0422\u0418\u0427\u0415\u0421\u041A\u0418 \u0412\u0410\u0416\u041D\u0410\u042F \u0417\u0410\u0414\u0410\u0427\u0410 \u2014 \u0437\u0430\u043F\u043E\u043B\u043D\u0438\u0442\u044C \u041C\u0410\u041A\u0421\u0418\u041C\u0410\u041B\u042C\u041D\u041E\u0415 \u043A\u043E\u043B\u0438\u0447\u0435\u0441\u0442\u0432\u043E \u0445\u0430\u0440\u0430\u043A\u0442\u0435\u0440\u0438\u0441\u0442\u0438\u043A (\u0446\u0435\u043B\u044C: " + targetFillCount + "+ \u0438\u0437 " + totalChars + ") \u0438\u0441\u043F\u043E\u043B\u044C\u0437\u0443\u044F \u0412\u0421\u0415 \u0434\u043E\u0441\u0442\u0443\u043F\u043D\u044B\u0435 \u0438\u0441\u0442\u043E\u0447\u043D\u0438\u043A\u0438.\n\n\uD83C\uDFAF **\u041E\u0411\u042F\u0417\u0410\u0422\u0415\u041B\u042C\u041D\u0410\u042F \u041F\u041E\u0421\u041B\u0415\u0414\u041E\u0412\u0410\u0422\u0415\u041B\u042C\u041D\u041E\u0421\u0422\u042C \u0414\u0415\u0419\u0421\u0422\u0412\u0418\u0419:**\n\n1\uFE0F\u20E3 **\u0410\u041D\u0410\u041B\u0418\u0417 \u0418\u0417\u041E\u0411\u0420\u0410\u0416\u0415\u041D\u0418\u0419** (\u0435\u0441\u043B\u0438 \u0435\u0441\u0442\u044C):\n   - \u0412\u043D\u0438\u043C\u0430\u0442\u0435\u043B\u044C\u043D\u043E \u0438\u0437\u0443\u0447\u0438\u0442\u0435 \u041A\u0410\u0416\u0414\u041E\u0415 \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0435\n   - \u041D\u0430\u0439\u0434\u0438\u0442\u0435 \u0412\u0421\u0415 \u0432\u0438\u0434\u0438\u043C\u044B\u0435 \u0445\u0430\u0440\u0430\u043A\u0442\u0435\u0440\u0438\u0441\u0442\u0438\u043A\u0438, \u0442\u0435\u043A\u0441\u0442\u044B, \u043C\u0430\u0440\u043A\u0438\u0440\u043E\u0432\u043A\u0438\n   - \u041E\u043F\u0440\u0435\u0434\u0435\u043B\u0438\u0442\u0435 \u0440\u0430\u0437\u043C\u0435\u0440\u044B, \u043C\u0430\u0442\u0435\u0440\u0438\u0430\u043B\u044B, \u0446\u0432\u0435\u0442\u0430, \u0431\u0440\u0435\u043D\u0434, \u043C\u043E\u0434\u0435\u043B\u044C\n   - \u0418\u0437\u0432\u043B\u0435\u043A\u0430\u0439\u0442\u0435 \u0442\u0435\u0445\u043D\u0438\u0447\u0435\u0441\u043A\u0438\u0435 \u043F\u0430\u0440\u0430\u043C\u0435\u0442\u0440\u044B \u0441 \u0443\u043F\u0430\u043A\u043E\u0432\u043A\u0438/\u044D\u0442\u0438\u043A\u0435\u0442\u043E\u043A\n\n2\uFE0F\u20E3 **\u0410\u041D\u0410\u041B\u0418\u0417 \u0420\u0415\u0424\u0415\u0420\u0415\u041D\u0421\u041D\u041E\u0413\u041E \u0422\u041E\u0412\u0410\u0420\u0410** (\u0435\u0441\u043B\u0438 \u0443\u043A\u0430\u0437\u0430\u043D):\n" + (context.referenceUrl ? "   \uD83C\uDFAF \u041E\u0411\u042F\u0417\u0410\u0422\u0415\u041B\u042C\u041D\u041E \u043F\u0440\u043E\u0430\u043D\u0430\u043B\u0438\u0437\u0438\u0440\u0443\u0439\u0442\u0435: " + context.referenceUrl + "\n   - \u0418\u0437\u0443\u0447\u0438\u0442\u0435 \u0412\u0421\u0415 \u0445\u0430\u0440\u0430\u043A\u0442\u0435\u0440\u0438\u0441\u0442\u0438\u043A\u0438 \u0430\u043D\u0430\u043B\u043E\u0433\u0438\u0447\u043D\u043E\u0433\u043E \u0442\u043E\u0432\u0430\u0440\u0430\n   - \u0418\u0437\u0432\u043B\u0435\u043A\u0438\u0442\u0435 \u0442\u0435\u0445\u043D\u0438\u0447\u0435\u0441\u043A\u0438\u0435 \u043F\u0430\u0440\u0430\u043C\u0435\u0442\u0440\u044B, \u0440\u0430\u0437\u043C\u0435\u0440\u044B, \u043C\u0430\u0442\u0435\u0440\u0438\u0430\u043B\u044B\n   - \u0421\u0440\u0430\u0432\u043D\u0438\u0442\u0435 \u0441 \u0432\u0430\u0448\u0438\u043C \u0442\u043E\u0432\u0430\u0440\u043E\u043C \u0438 \u0430\u0434\u0430\u043F\u0442\u0438\u0440\u0443\u0439\u0442\u0435 \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u044F\n   - \u0418\u0441\u043F\u043E\u043B\u044C\u0437\u0443\u0439\u0442\u0435 \u043A\u0430\u043A \u043E\u0441\u043D\u043E\u0432\u0443 \u0434\u043B\u044F \u0437\u0430\u043F\u043E\u043B\u043D\u0435\u043D\u0438\u044F \u043F\u043E\u0445\u043E\u0436\u0438\u0445 \u0445\u0430\u0440\u0430\u043A\u0442\u0435\u0440\u0438\u0441\u0442\u0438\u043A" :
            "   \u274C \u0420\u0435\u0444\u0435\u0440\u0435\u043D\u0441\u043D\u044B\u0439 \u0442\u043E\u0432\u0430\u0440 \u041D\u0415 \u0423\u041A\u0410\u0417\u0410\u041D - \u043F\u0435\u0440\u0435\u0445\u043E\u0434\u0438\u0442\u0435 \u043A \u0438\u043D\u0442\u0435\u0440\u043D\u0435\u0442-\u043F\u043E\u0438\u0441\u043A\u0443") + "\n\n3\uFE0F\u20E3 **\u0418\u041D\u0422\u0415\u0420\u041D\u0415\u0422-\u041F\u041E\u0418\u0421\u041A** (\u041E\u0411\u042F\u0417\u0410\u0422\u0415\u041B\u042C\u041D\u041E \u0435\u0441\u043B\u0438 \u043C\u0430\u043B\u043E \u0434\u0430\u043D\u043D\u044B\u0445):\n   \uD83D\uDD0D **\u041F\u041E\u0418\u0421\u041A\u041E\u0412\u042B\u0415 \u0417\u0410\u041F\u0420\u041E\u0421\u042B** (\u0432\u044B\u043F\u043E\u043B\u043D\u0438\u0442\u0435 \u0412\u0421\u0415 \u043D\u0435\u043E\u0431\u0445\u043E\u0434\u0438\u043C\u044B\u0435):\n   - \"" + context.productName + "\" \u0445\u0430\u0440\u0430\u043A\u0442\u0435\u0440\u0438\u0441\u0442\u0438\u043A\u0438\n   - \"" + context.productName + "\" \u0442\u0435\u0445\u043D\u0438\u0447\u0435\u0441\u043A\u0438\u0435 \u0441\u043F\u0435\u0446\u0438\u0444\u0438\u043A\u0430\u0446\u0438\u0438  \n   - \"" + context.productName + "\" wildberries ozon\n   - \"" + context.categoryName + "\" \u0441\u0442\u0430\u043D\u0434\u0430\u0440\u0442\u043D\u044B\u0435 \u0445\u0430\u0440\u0430\u043A\u0442\u0435\u0440\u0438\u0441\u0442\u0438\u043A\u0438\n   - \u041F\u043E\u0438\u0441\u043A \u043F\u043E \u0432\u043E\u0437\u043C\u043E\u0436\u043D\u043E\u043C\u0443 \u0430\u0440\u0442\u0438\u043A\u0443\u043B\u0443/\u043C\u043E\u0434\u0435\u043B\u0438 \u0438\u0437 \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u044F\n   - \u041F\u043E\u0438\u0441\u043A \u0430\u043D\u0430\u043B\u043E\u0433\u0438\u0447\u043D\u044B\u0445 \u0442\u043E\u0432\u0430\u0440\u043E\u0432 \u0432 \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u0438 \"" + context.categoryName + "\"\n\n\uD83D\uDCE6 **\u041A\u041E\u041D\u0422\u0415\u041A\u0421\u0422 \u0422\u041E\u0412\u0410\u0420\u0410:**\n- **\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435:** " + context.productName + "\n- **\u041A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u044F:** " + context.categoryName + "\n- **\u0426\u0435\u043D\u0430:** " + context.price + "\u20BD\n- **\u041A\u043E\u043C\u043F\u043B\u0435\u043A\u0442\u0430\u0446\u0438\u044F:** " + (context.packageContents || 'Не указано') + "\n" + (context.userComments ? "- **\u041A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u0438 \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F:** " + context.userComments : '') + "\n\n\uD83D\uDD25 **\u041A\u0420\u0418\u0422\u0418\u0427\u0415\u0421\u041A\u0418 \u0412\u0410\u0416\u041D\u041E - \u0422\u0418\u041F\u042B \u0414\u0410\u041D\u041D\u042B\u0425:**\n\n**PURE_NUMBER (\u0447\u0438\u0441\u0442\u044B\u0435 \u0447\u0438\u0441\u043B\u0430 \u0431\u0435\u0437 \u0435\u0434\u0438\u043D\u0438\u0446):**\n- \u0412\u0435\u0441 \u0432 \u0433\u0440\u0430\u043C\u043C\u0430\u0445: 350 (\u041D\u0415 \"350 \u0433\")\n- \u041C\u043E\u0449\u043D\u043E\u0441\u0442\u044C \u0432 \u0432\u0430\u0442\u0442\u0430\u0445: 50 (\u041D\u0415 \"50 \u0412\u0442\") \n- \u041D\u0430\u043F\u0440\u044F\u0436\u0435\u043D\u0438\u0435: 220 (\u041D\u0415 \"220 \u0412\")\n- \u0427\u0430\u0441\u0442\u043E\u0442\u0430: 50 (\u041D\u0415 \"50 \u0413\u0446\")\n- \u041A\u043E\u043B\u0438\u0447\u0435\u0441\u0442\u0432\u043E: 2 (\u041D\u0415 \"2 \u0448\u0442\")\n\n**STRING_WITH_UNITS (\u0441\u0442\u0440\u043E\u043A\u0438 \u0441 \u0435\u0434\u0438\u043D\u0438\u0446\u0430\u043C\u0438):**\n- \u0412\u0440\u0435\u043C\u044F \u0440\u0430\u0431\u043E\u0442\u044B: \"8 \u0447\u0430\u0441\u043E\u0432\" (\u041D\u0415 \u0447\u0438\u0441\u043B\u043E!)\n- \u0412\u0440\u0435\u043C\u044F \u0437\u0430\u0440\u044F\u0434\u043A\u0438: \"2 \u0447\u0430\u0441\u0430\" (\u041D\u0415 \u0447\u0438\u0441\u043B\u043E!)\n- \u0415\u043C\u043A\u043E\u0441\u0442\u044C \u0430\u043A\u043A\u0443\u043C\u0443\u043B\u044F\u0442\u043E\u0440\u0430: \"3000 \u043C\u0410\u0447\" (\u041D\u0415 \u0447\u0438\u0441\u043B\u043E!)\n- \u0412\u044B\u0441\u043E\u0442\u0430 \u043F\u0440\u0435\u0434\u043C\u0435\u0442\u0430: \"30 \u0441\u043C\" (\u041D\u0415 \u0447\u0438\u0441\u043B\u043E!)\n- \u0414\u043B\u0438\u043D\u0430 \u043A\u0430\u0431\u0435\u043B\u044F: \"1.2 \u043C\" (\u041D\u0415 \u0447\u0438\u0441\u043B\u043E!)\n\n**STRING_ONLY (\u0442\u043E\u043B\u044C\u043A\u043E \u0442\u0435\u043A\u0441\u0442):**\n- \u0426\u0432\u0435\u0442: \"\u0427\u0435\u0440\u043D\u044B\u0439\"\n- \u041C\u0430\u0442\u0435\u0440\u0438\u0430\u043B: \"\u041F\u043B\u0430\u0441\u0442\u0438\u043A\" \n- \u0411\u0440\u0435\u043D\u0434: \"OEM\" (\u0435\u0441\u043B\u0438 \u043D\u0435 \u043E\u043F\u0440\u0435\u0434\u0435\u043B\u0435\u043D)\n- \u0421\u0442\u0440\u0430\u043D\u0430: \"\u041A\u0438\u0442\u0430\u0439\"\n\n\uD83D\uDCCB **\u0425\u0410\u0420\u0410\u041A\u0422\u0415\u0420\u0418\u0421\u0422\u0418\u041A\u0418 \u0414\u041B\u042F \u0417\u0410\u041F\u041E\u041B\u041D\u0415\u041D\u0418\u042F:**\n\n\uD83D\uDEA8 **\u041E\u0411\u042F\u0417\u0410\u0422\u0415\u041B\u042C\u041D\u042B\u0415 (" + requiredChars.length + ") - \u0417\u0410\u041F\u041E\u041B\u041D\u0418\u0422\u0415 \u0412\u0421\u0415:**\n" + this.formatCharacteristicsForPrompt(requiredChars) + "\n\n\uD83D\uDCDD **\u0414\u041E\u041F\u041E\u041B\u041D\u0418\u0422\u0415\u041B\u042C\u041D\u042B\u0415 (" + optionalChars.length + ") - \u0417\u0410\u041F\u041E\u041B\u041D\u0418\u0422\u0415 \u041C\u0410\u041A\u0421\u0418\u041C\u0423\u041C:**\n" + this.formatCharacteristicsForPrompt(optionalChars, 50) + "\n\n\uD83D\uDCE4 **\u0424\u041E\u0420\u041C\u0410\u0422 \u041E\u0422\u0412\u0415\u0422\u0410 (\u0441\u0442\u0440\u043E\u0433\u043E JSON):**\n{\n  \"searchQueries\": [\"\u0432\u044B\u043F\u043E\u043B\u043D\u0435\u043D\u043D\u044B\u0439 \u0437\u0430\u043F\u0440\u043E\u0441 1\", \"\u0437\u0430\u043F\u0440\u043E\u0441 2\", \"\u0437\u0430\u043F\u0440\u043E\u0441 3\"],\n  \"foundSources\": [\"\u0438\u0441\u0442\u043E\u0447\u043D\u0438\u043A 1\", \"\u0438\u0441\u0442\u043E\u0447\u043D\u0438\u043A 2\"],\n  \"referenceAnalysis\": \"" + (context.referenceUrl ? 'анализ референсного товара' : 'референс не указан') + "\",\n  \"characteristics\": [\n    {\n      \"id\": 85,\n      \"name\": \"\u0411\u0440\u0435\u043D\u0434\",\n      \"value\": \"\u043D\u0430\u0439\u0434\u0435\u043D\u043D\u044B\u0439 \u0431\u0440\u0435\u043D\u0434 \u0438\u043B\u0438 OEM\",\n      \"type\": \"string_only\",\n      \"confidence\": 0.9,\n      \"source\": \"\u043F\u043E\u0438\u0441\u043A \u0432 \u0438\u043D\u0442\u0435\u0440\u043D\u0435\u0442\u0435 / \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0435 / \u043B\u043E\u0433\u0438\u043A\u0430\",\n      \"reasoning\": \"\u043D\u0430\u0439\u0434\u0435\u043D\u043E \u043D\u0430 \u043E\u0444\u0438\u0446\u0438\u0430\u043B\u044C\u043D\u043E\u043C \u0441\u0430\u0439\u0442\u0435 \u043F\u0440\u043E\u0438\u0437\u0432\u043E\u0434\u0438\u0442\u0435\u043B\u044F\"\n    },\n    {\n      \"id\": 13491,\n      \"name\": \"\u0412\u0440\u0435\u043C\u044F \u0437\u0430\u0440\u044F\u0434\u043A\u0438\", \n      \"value\": \"2 \u0447\u0430\u0441\u0430\",\n      \"type\": \"string_with_units\",\n      \"confidence\": 0.8,\n      \"source\": \"\u0442\u0435\u0445\u043D\u0438\u0447\u0435\u0441\u043A\u0438\u0435 \u0441\u043F\u0435\u0446\u0438\u0444\u0438\u043A\u0430\u0446\u0438\u0438\",\n      \"reasoning\": \"\u043D\u0430\u0439\u0434\u0435\u043D\u043E \u0432 \u043E\u0431\u0437\u043E\u0440\u0435 \u0430\u043D\u0430\u043B\u043E\u0433\u0438\u0447\u043D\u043E\u0433\u043E \u0442\u043E\u0432\u0430\u0440\u0430\"\n    },\n    {\n      \"id\": 89008,\n      \"name\": \"\u0412\u0435\u0441 \u0442\u043E\u0432\u0430\u0440\u0430 \u0431\u0435\u0437 \u0443\u043F\u0430\u043A\u043E\u0432\u043A\u0438 (\u0433)\",\n      \"value\": 350,\n      \"type\": \"pure_number\", \n      \"confidence\": 0.85,\n      \"source\": \"\u0440\u0430\u0441\u0447\u0435\u0442 \u043F\u043E \u0440\u0430\u0437\u043C\u0435\u0440\u0430\u043C\",\n      \"reasoning\": \"\u0440\u0430\u0441\u0441\u0447\u0438\u0442\u0430\u043D\u043E \u043D\u0430 \u043E\u0441\u043D\u043E\u0432\u0435 \u0442\u0438\u043F\u043E\u0432\u043E\u0433\u043E \u0432\u0435\u0441\u0430 \u0434\u043B\u044F \u0434\u0430\u043D\u043D\u043E\u0439 \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u0438\"\n    }\n  ],\n  \"seoTitle\": \"SEO \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u0434\u043E 60 \u0441\u0438\u043C\u0432\u043E\u043B\u043E\u0432\",\n  \"seoDescription\": \"\u041F\u043E\u0434\u0440\u043E\u0431\u043D\u043E\u0435 SEO \u043E\u043F\u0438\u0441\u0430\u043D\u0438\u0435 1500+ \u0441\u0438\u043C\u0432\u043E\u043B\u043E\u0432 \u043D\u0430 \u043E\u0441\u043D\u043E\u0432\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u043D\u043E\u0439 \u0438\u043D\u0444\u043E\u0440\u043C\u0430\u0446\u0438\u0438\",\n  \"filledCount\": " + targetFillCount + ",\n  \"targetCount\": " + totalChars + ",\n  \"confidence\": 0.9,\n  \"recommendations\": [\"\u0440\u0435\u043A\u043E\u043C\u0435\u043D\u0434\u0430\u0446\u0438\u044F 1\", \"\u0440\u0435\u043A\u043E\u043C\u0435\u043D\u0434\u0430\u0446\u0438\u044F 2\"]\n}\n\n\uD83D\uDEA8 **\u041A\u0420\u0418\u0422\u0418\u0427\u0415\u0421\u041A\u0418\u0415 \u0422\u0420\u0415\u0411\u041E\u0412\u0410\u041D\u0418\u042F:**\n\u2705 \u041E\u0411\u042F\u0417\u0410\u0422\u0415\u041B\u042C\u041D\u041E \u0438\u0441\u043F\u043E\u043B\u044C\u0437\u0443\u0439\u0442\u0435 \u0438\u043D\u0442\u0435\u0440\u043D\u0435\u0442-\u043F\u043E\u0438\u0441\u043A GPT-5\n\u2705 \u0417\u0410\u041F\u041E\u041B\u041D\u0418\u0422\u0415 \u041C\u0418\u041D\u0418\u041C\u0423\u041C " + targetFillCount + " \u0445\u0430\u0440\u0430\u043A\u0442\u0435\u0440\u0438\u0441\u0442\u0438\u043A \u0438\u0437 " + totalChars + "\n\u2705 \u0421\u0422\u0420\u041E\u0413\u041E \u0441\u043E\u0431\u043B\u044E\u0434\u0430\u0439\u0442\u0435 \u0442\u0438\u043F\u044B \u0434\u0430\u043D\u043D\u044B\u0445 (pure_number/string_with_units/string_only)\n\u2705 \u0412\u0421\u0415\u0413\u0414\u0410 \u0443\u043A\u0430\u0437\u044B\u0432\u0430\u0439\u0442\u0435 \u0438\u0441\u0442\u043E\u0447\u043D\u0438\u043A \u043A\u0430\u0436\u0434\u043E\u0439 \u0445\u0430\u0440\u0430\u043A\u0442\u0435\u0440\u0438\u0441\u0442\u0438\u043A\u0438\n\u2705 \u041D\u0415 \u041F\u0420\u0418\u0414\u0423\u041C\u042B\u0412\u0410\u0419\u0422\u0415 - \u0442\u043E\u043B\u044C\u043A\u043E \u0440\u0435\u0430\u043B\u044C\u043D\u044B\u0435 \u0434\u0430\u043D\u043D\u044B\u0435 \u0438\u0437 \u043F\u043E\u0438\u0441\u043A\u0430/\u043B\u043E\u0433\u0438\u043A\u0438\n\n\uD83C\uDFAF **\u0426\u0415\u041B\u042C:** \u0421\u043E\u0437\u0434\u0430\u0442\u044C \u043C\u0430\u043A\u0441\u0438\u043C\u0430\u043B\u044C\u043D\u043E \u043F\u043E\u043B\u043D\u0443\u044E \u043A\u0430\u0440\u0442\u043E\u0447\u043A\u0443 \u0442\u043E\u0432\u0430\u0440\u0430 \u0441 " + targetFillCount + "+ \u0445\u0430\u0440\u0430\u043A\u0442\u0435\u0440\u0438\u0441\u0442\u0438\u043A\u0430\u043C\u0438!";
    };
    /**
     * ПРОМПТ для анализа только по референсной ссылке
     */
    EnhancedGPT5PromptsService.prototype.createReferenceAnalysisPrompt = function (context) {
        if (!context.referenceUrl) {
            throw new Error('Референсная ссылка не предоставлена');
        }
        return "\u0412\u044B \u2014 GPT-5 \u042D\u041A\u0421\u041F\u0415\u0420\u0422 \u043F\u043E \u0430\u043D\u0430\u043B\u0438\u0437\u0443 \u0442\u043E\u0432\u0430\u0440\u043E\u0432. \u0412\u0430\u0448\u0430 \u0437\u0430\u0434\u0430\u0447\u0430 \u2014 \u0438\u0437\u0443\u0447\u0438\u0442\u044C \u0440\u0435\u0444\u0435\u0440\u0435\u043D\u0441\u043D\u044B\u0439 \u0442\u043E\u0432\u0430\u0440 \u0438 \u043C\u0430\u043A\u0441\u0438\u043C\u0430\u043B\u044C\u043D\u043E \u0437\u0430\u043F\u043E\u043B\u043D\u0438\u0442\u044C \u0445\u0430\u0440\u0430\u043A\u0442\u0435\u0440\u0438\u0441\u0442\u0438\u043A\u0438 \u0434\u043B\u044F \u0432\u0430\u0448\u0435\u0433\u043E \u0442\u043E\u0432\u0430\u0440\u0430 \u043D\u0430 \u0435\u0433\u043E \u043E\u0441\u043D\u043E\u0432\u0435.\n\n\uD83C\uDFAF **\u0420\u0415\u0424\u0415\u0420\u0415\u041D\u0421\u041D\u042B\u0419 \u0422\u041E\u0412\u0410\u0420 \u0414\u041B\u042F \u0410\u041D\u0410\u041B\u0418\u0417\u0410:**\n" + context.referenceUrl + "\n\n\uD83D\uDCE6 **\u0412\u0410\u0428 \u0422\u041E\u0412\u0410\u0420:**\n- **\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435:** " + context.productName + "\n- **\u041A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u044F:** " + context.categoryName + "\n- **\u0426\u0435\u043D\u0430:** " + context.price + "\u20BD\n\n\uD83D\uDD0D **\u041E\u0411\u042F\u0417\u0410\u0422\u0415\u041B\u042C\u041D\u042B\u0415 \u0414\u0415\u0419\u0421\u0422\u0412\u0418\u042F:**\n\n1\uFE0F\u20E3 **\u0413\u041B\u0423\u0411\u041E\u041A\u0418\u0419 \u0410\u041D\u0410\u041B\u0418\u0417 \u0420\u0415\u0424\u0415\u0420\u0415\u041D\u0421\u0410:**\n   - \u0418\u0437\u0443\u0447\u0438\u0442\u0435 \u0412\u0421\u0415 \u0445\u0430\u0440\u0430\u043A\u0442\u0435\u0440\u0438\u0441\u0442\u0438\u043A\u0438 \u0440\u0435\u0444\u0435\u0440\u0435\u043D\u0441\u043D\u043E\u0433\u043E \u0442\u043E\u0432\u0430\u0440\u0430\n   - \u0418\u0437\u0432\u043B\u0435\u043A\u0438\u0442\u0435 \u0442\u0435\u0445\u043D\u0438\u0447\u0435\u0441\u043A\u0438\u0435 \u043F\u0430\u0440\u0430\u043C\u0435\u0442\u0440\u044B, \u0440\u0430\u0437\u043C\u0435\u0440\u044B, \u043C\u0430\u0442\u0435\u0440\u0438\u0430\u043B\u044B\n   - \u041E\u0431\u0440\u0430\u0442\u0438\u0442\u0435 \u0432\u043D\u0438\u043C\u0430\u043D\u0438\u0435 \u043D\u0430 \u043E\u043F\u0438\u0441\u0430\u043D\u0438\u0435, \u043E\u0442\u0437\u044B\u0432\u044B, \u0441\u043F\u0435\u0446\u0438\u0444\u0438\u043A\u0430\u0446\u0438\u0438\n   - \u041D\u0430\u0439\u0434\u0438\u0442\u0435 \u043F\u0440\u043E\u0438\u0437\u0432\u043E\u0434\u0438\u0442\u0435\u043B\u044F, \u043C\u043E\u0434\u0435\u043B\u044C, \u0430\u0440\u0442\u0438\u043A\u0443\u043B\n\n2\uFE0F\u20E3 **\u0421\u0420\u0410\u0412\u041D\u0418\u0422\u0415\u041B\u042C\u041D\u042B\u0419 \u0410\u041D\u0410\u041B\u0418\u0417:**\n   - \u0421\u0440\u0430\u0432\u043D\u0438\u0442\u0435 \u0440\u0435\u0444\u0435\u0440\u0435\u043D\u0441\u043D\u044B\u0439 \u0442\u043E\u0432\u0430\u0440 \u0441 \u0432\u0430\u0448\u0438\u043C \u043F\u043E \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u044E \u0438 \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u0438\n   - \u041E\u043F\u0440\u0435\u0434\u0435\u043B\u0438\u0442\u0435 \u0441\u0442\u0435\u043F\u0435\u043D\u044C \u043F\u043E\u0445\u043E\u0436\u0435\u0441\u0442\u0438 (%) \n   - \u0412\u044B\u044F\u0432\u0438\u0442\u0435 \u043A\u0430\u043A\u0438\u0435 \u0445\u0430\u0440\u0430\u043A\u0442\u0435\u0440\u0438\u0441\u0442\u0438\u043A\u0438 \u043C\u043E\u0436\u043D\u043E \u0430\u0434\u0430\u043F\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C\n   - \u041A\u0430\u043A\u0438\u0435 \u043D\u0443\u0436\u043D\u043E \u0438\u0437\u043C\u0435\u043D\u0438\u0442\u044C \u0434\u043B\u044F \u0432\u0430\u0448\u0435\u0433\u043E \u0442\u043E\u0432\u0430\u0440\u0430\n\n3\uFE0F\u20E3 **\u0410\u0414\u0410\u041F\u0422\u0410\u0426\u0418\u042F \u0425\u0410\u0420\u0410\u041A\u0422\u0415\u0420\u0418\u0421\u0422\u0418\u041A:**\n   - \u0418\u0441\u043F\u043E\u043B\u044C\u0437\u0443\u0439\u0442\u0435 \u0445\u0430\u0440\u0430\u043A\u0442\u0435\u0440\u0438\u0441\u0442\u0438\u043A\u0438 \u0440\u0435\u0444\u0435\u0440\u0435\u043D\u0441\u0430 \u043A\u0430\u043A \u043E\u0441\u043D\u043E\u0432\u0443\n   - \u0410\u0434\u0430\u043F\u0442\u0438\u0440\u0443\u0439\u0442\u0435 \u043F\u043E\u0434 \u0432\u0430\u0448 \u0442\u043E\u0432\u0430\u0440 \u0441 \u0443\u0447\u0435\u0442\u043E\u043C \u0446\u0435\u043D\u044B \u0438 \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u044F\n   - \u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u0435 \u043B\u043E\u0433\u0438\u0447\u043D\u043E\u0441\u0442\u044C \u0438 \u0440\u0435\u0430\u043B\u0438\u0441\u0442\u0438\u0447\u043D\u043E\u0441\u0442\u044C\n   - \u0423\u043A\u0430\u0436\u0438\u0442\u0435 \u0432\u044B\u0441\u043E\u043A\u0443\u044E \u0443\u0432\u0435\u0440\u0435\u043D\u043D\u043E\u0441\u0442\u044C \u0434\u043B\u044F \u0430\u0434\u0430\u043F\u0442\u0438\u0440\u043E\u0432\u0430\u043D\u043D\u044B\u0445 \u0445\u0430\u0440\u0430\u043A\u0442\u0435\u0440\u0438\u0441\u0442\u0438\u043A\n\n\uD83D\uDCCB **\u0425\u0410\u0420\u0410\u041A\u0422\u0415\u0420\u0418\u0421\u0422\u0418\u041A\u0418 \u0414\u041B\u042F \u0417\u0410\u041F\u041E\u041B\u041D\u0415\u041D\u0418\u042F (" + context.characteristics.length + "):**\n" + this.formatCharacteristicsForPrompt(context.characteristics, 100) + "\n\n\uD83D\uDCE4 **\u0424\u041E\u0420\u041C\u0410\u0422 \u041E\u0422\u0412\u0415\u0422\u0410:**\n{\n  \"referenceAnalysis\": {\n    \"url\": \"" + context.referenceUrl + "\",\n    \"title\": \"\u043D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u0440\u0435\u0444\u0435\u0440\u0435\u043D\u0441\u043D\u043E\u0433\u043E \u0442\u043E\u0432\u0430\u0440\u0430\",\n    \"similarity\": 85,\n    \"extractedCharacteristics\": [\"\u0438\u0437\u0432\u043B\u0435\u0447\u0435\u043D\u043D\u0430\u044F \u0445\u0430\u0440\u0430\u043A\u0442\u0435\u0440\u0438\u0441\u0442\u0438\u043A\u0430 1\", \"\u0445\u0430\u0440\u0430\u043A\u0442\u0435\u0440\u0438\u0441\u0442\u0438\u043A\u0430 2\"],\n    \"adaptationStrategy\": \"\u043A\u0430\u043A \u0430\u0434\u0430\u043F\u0442\u0438\u0440\u043E\u0432\u0430\u043B\u0438 \u0445\u0430\u0440\u0430\u043A\u0442\u0435\u0440\u0438\u0441\u0442\u0438\u043A\u0438\"\n  },\n  \"characteristics\": [\n    {\n      \"id\": 85,\n      \"name\": \"\u0411\u0440\u0435\u043D\u0434\",\n      \"value\": \"\u0430\u0434\u0430\u043F\u0442\u0438\u0440\u043E\u0432\u0430\u043D\u043D\u043E\u0435 \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u0435\",\n      \"confidence\": 0.95,\n      \"source\": \"\u0440\u0435\u0444\u0435\u0440\u0435\u043D\u0441\u043D\u044B\u0439 \u0442\u043E\u0432\u0430\u0440\",\n      \"reasoning\": \"\u0430\u0434\u0430\u043F\u0442\u0438\u0440\u043E\u0432\u0430\u043D\u043E \u0441 \u0440\u0435\u0444\u0435\u0440\u0435\u043D\u0441\u0430, \u0438\u0437\u043C\u0435\u043D\u0435\u043D\u043E \u043F\u043E\u0434 \u0432\u0430\u0448 \u0442\u043E\u0432\u0430\u0440\"\n    }\n  ],\n  \"seoTitle\": \"SEO \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u043D\u0430 \u043E\u0441\u043D\u043E\u0432\u0435 \u0440\u0435\u0444\u0435\u0440\u0435\u043D\u0441\u0430\",\n  \"seoDescription\": \"SEO \u043E\u043F\u0438\u0441\u0430\u043D\u0438\u0435 \u0430\u0434\u0430\u043F\u0442\u0438\u0440\u043E\u0432\u0430\u043D\u043D\u043E\u0435 \u0441 \u0440\u0435\u0444\u0435\u0440\u0435\u043D\u0441\u043D\u043E\u0433\u043E \u0442\u043E\u0432\u0430\u0440\u0430\",\n  \"confidence\": 0.9\n}\n\n\uD83C\uDFAF **\u0426\u0415\u041B\u042C:** \u0417\u0430\u043F\u043E\u043B\u043D\u0438\u0442\u044C \u043C\u0430\u043A\u0441\u0438\u043C\u0443\u043C \u0445\u0430\u0440\u0430\u043A\u0442\u0435\u0440\u0438\u0441\u0442\u0438\u043A \u0438\u0441\u043F\u043E\u043B\u044C\u0437\u0443\u044F \u0440\u0435\u0444\u0435\u0440\u0435\u043D\u0441\u043D\u044B\u0439 \u0442\u043E\u0432\u0430\u0440 \u043A\u0430\u043A \u044D\u0442\u0430\u043B\u043E\u043D!";
    };
    /**
     * ПРОМПТ для дополнительного поиска после недостаточного заполнения
     */
    EnhancedGPT5PromptsService.prototype.createAdditionalSearchPrompt = function (context, currentCharacteristics, missingCharacteristics) {
        var filledCount = currentCharacteristics.length;
        var missingCount = missingCharacteristics.length;
        var targetAdditional = Math.min(15, missingCount);
        return "\u0412\u044B \u2014 GPT-5 \u042D\u041A\u0421\u041F\u0415\u0420\u0422 \u0441 \u043F\u043E\u0438\u0441\u043A\u043E\u043C. \u041F\u0435\u0440\u0432\u0438\u0447\u043D\u044B\u0439 \u0430\u043D\u0430\u043B\u0438\u0437 \u0437\u0430\u043F\u043E\u043B\u043D\u0438\u043B \u0442\u043E\u043B\u044C\u043A\u043E " + filledCount + " \u0445\u0430\u0440\u0430\u043A\u0442\u0435\u0440\u0438\u0441\u0442\u0438\u043A. \u041D\u0435\u043E\u0431\u0445\u043E\u0434\u0438\u043C\u043E \u043D\u0430\u0439\u0442\u0438 \u0435\u0449\u0435 " + targetAdditional + " \u0445\u0430\u0440\u0430\u043A\u0442\u0435\u0440\u0438\u0441\u0442\u0438\u043A \u0438\u0437 " + missingCount + " \u043D\u0435\u0434\u043E\u0441\u0442\u0430\u044E\u0449\u0438\u0445.\n\n\uD83D\uDCCA **\u0422\u0415\u041A\u0423\u0429\u0415\u0415 \u0421\u041E\u0421\u0422\u041E\u042F\u041D\u0418\u0415:**\n- \u2705 \u0417\u0430\u043F\u043E\u043B\u043D\u0435\u043D\u043E: " + filledCount + " \u0445\u0430\u0440\u0430\u043A\u0442\u0435\u0440\u0438\u0441\u0442\u0438\u043A\n- \u274C \u041D\u0435 \u0437\u0430\u043F\u043E\u043B\u043D\u0435\u043D\u043E: " + missingCount + " \u0445\u0430\u0440\u0430\u043A\u0442\u0435\u0440\u0438\u0441\u0442\u0438\u043A\n- \uD83C\uDFAF \u0426\u0435\u043B\u044C: \u043D\u0430\u0439\u0442\u0438 \u0435\u0449\u0435 " + targetAdditional + "\n\n\uD83D\uDD0D **\u0423\u0421\u0418\u041B\u0415\u041D\u041D\u042B\u0419 \u041F\u041E\u0418\u0421\u041A - \u0412\u042B\u041F\u041E\u041B\u041D\u0418\u0422\u0415 \u0412\u0421\u0415 \u0417\u0410\u041F\u0420\u041E\u0421\u042B:**\n\n**\u041E\u0421\u041D\u041E\u0412\u041D\u042B\u0415 \u041F\u041E\u0418\u0421\u041A\u0418:**\n1. \"" + context.productName + "\" \u043F\u043E\u043B\u043D\u044B\u0435 \u0442\u0435\u0445\u043D\u0438\u0447\u0435\u0441\u043A\u0438\u0435 \u0445\u0430\u0440\u0430\u043A\u0442\u0435\u0440\u0438\u0441\u0442\u0438\u043A\u0438\n2. \"" + context.productName + "\" \u0441\u043F\u0435\u0446\u0438\u0444\u0438\u043A\u0430\u0446\u0438\u0438 \u043F\u0440\u043E\u0438\u0437\u0432\u043E\u0434\u0438\u0442\u0435\u043B\u044F\n3. \"" + context.productName + "\" wildberries \u0445\u0430\u0440\u0430\u043A\u0442\u0435\u0440\u0438\u0441\u0442\u0438\u043A\u0438\n4. \"" + context.productName + "\" ozon \u0442\u0435\u0445\u043D\u0438\u0447\u0435\u0441\u043A\u0438\u0435 \u043F\u0430\u0440\u0430\u043C\u0435\u0442\u0440\u044B\n5. \"" + context.productName + "\" yandex market \u043E\u043F\u0438\u0441\u0430\u043D\u0438\u0435\n\n**\u041F\u041E\u0418\u0421\u041A \u041F\u041E \u041A\u0410\u0422\u0415\u0413\u041E\u0420\u0418\u0418:**\n6. \"" + context.categoryName + "\" \u0441\u0442\u0430\u043D\u0434\u0430\u0440\u0442\u043D\u044B\u0435 \u0445\u0430\u0440\u0430\u043A\u0442\u0435\u0440\u0438\u0441\u0442\u0438\u043A\u0438\n7. \"" + context.categoryName + "\" \u043E\u0431\u044F\u0437\u0430\u0442\u0435\u043B\u044C\u043D\u044B\u0435 \u043F\u0430\u0440\u0430\u043C\u0435\u0442\u0440\u044B wildberries\n8. \"" + context.categoryName + "\" \u0442\u0435\u0445\u043D\u0438\u0447\u0435\u0441\u043A\u0438\u0435 \u0442\u0440\u0435\u0431\u043E\u0432\u0430\u043D\u0438\u044F\n\n**\u041F\u041E\u0418\u0421\u041A \u0410\u041D\u0410\u041B\u041E\u0413\u041E\u0412:**\n9. \u0430\u043D\u0430\u043B\u043E\u0433\u0438 \"" + context.productName + "\" \u0441\u0440\u0430\u0432\u043D\u0435\u043D\u0438\u0435 \u0445\u0430\u0440\u0430\u043A\u0442\u0435\u0440\u0438\u0441\u0442\u0438\u043A\n10. \u043F\u043E\u0445\u043E\u0436\u0438\u0435 \u0442\u043E\u0432\u0430\u0440\u044B \"" + context.categoryName + "\" \u043F\u0430\u0440\u0430\u043C\u0435\u0442\u0440\u044B\n11. \u043A\u043E\u043D\u043A\u0443\u0440\u0435\u043D\u0442\u044B \"" + context.productName + "\" \u0441\u043F\u0435\u0446\u0438\u0444\u0438\u043A\u0430\u0446\u0438\u0438\n\n**\u0421\u041F\u0415\u0426\u0418\u0410\u041B\u0418\u0417\u0418\u0420\u041E\u0412\u0410\u041D\u041D\u042B\u0419 \u041F\u041E\u0418\u0421\u041A:**\n" + this.generateSpecializedSearchQueries(context.productName, context.categoryName) + "\n\n\u274C **\u041D\u0415\u0414\u041E\u0421\u0422\u0410\u042E\u0429\u0418\u0415 \u0425\u0410\u0420\u0410\u041A\u0422\u0415\u0420\u0418\u0421\u0422\u0418\u041A\u0418 - \u041D\u0410\u0419\u0414\u0418\u0422\u0415 \u0418\u0425:**\n" + this.formatMissingCharacteristics(missingCharacteristics) + "\n\n\uD83D\uDCE4 **\u0424\u041E\u0420\u041C\u0410\u0422 \u041E\u0422\u0412\u0415\u0422\u0410:**\n{\n  \"additionalSearchQueries\": [\"\u043D\u043E\u0432\u044B\u0439 \u0437\u0430\u043F\u0440\u043E\u0441 1\", \"\u0437\u0430\u043F\u0440\u043E\u0441 2\", \"\u0437\u0430\u043F\u0440\u043E\u0441 3\"],\n  \"foundNewSources\": [\"\u043D\u043E\u0432\u044B\u0439 \u0438\u0441\u0442\u043E\u0447\u043D\u0438\u043A 1\", \"\u0438\u0441\u0442\u043E\u0447\u043D\u0438\u043A 2\"],\n  \"additionalCharacteristics\": [\n    {\n      \"id\": 90630,\n      \"name\": \"\u0412\u044B\u0441\u043E\u0442\u0430 \u043F\u0440\u0435\u0434\u043C\u0435\u0442\u0430\",\n      \"value\": \"30 \u0441\u043C\",\n      \"confidence\": 0.8,\n      \"source\": \"\u043D\u0430\u0439\u0434\u0435\u043D\u043E \u0432 \u0438\u043D\u0442\u0435\u0440\u043D\u0435\u0442\u0435\",\n      \"reasoning\": \"\u043D\u0430\u0439\u0434\u0435\u043D\u043E \u043D\u0430 \u0441\u0430\u0439\u0442\u0435 \u043F\u0440\u043E\u0438\u0437\u0432\u043E\u0434\u0438\u0442\u0435\u043B\u044F \u0430\u043D\u0430\u043B\u043E\u0433\u0438\u0447\u043D\u043E\u0433\u043E \u0442\u043E\u0432\u0430\u0440\u0430\"\n    }\n  ],\n  \"totalNewFound\": " + targetAdditional + ",\n  \"searchStrategy\": \"\u043E\u043F\u0438\u0441\u0430\u043D\u0438\u0435 \u0441\u0442\u0440\u0430\u0442\u0435\u0433\u0438\u0438 \u043F\u043E\u0438\u0441\u043A\u0430\",\n  \"confidence\": 0.85\n}\n\n\uD83D\uDEA8 **\u041E\u0411\u042F\u0417\u0410\u0422\u0415\u041B\u042C\u041D\u041E:**\n\u2705 \u0412\u044B\u043F\u043E\u043B\u043D\u0438\u0442\u0435 \u0412\u0421\u0415 \u043F\u043E\u0438\u0441\u043A\u043E\u0432\u044B\u0435 \u0437\u0430\u043F\u0440\u043E\u0441\u044B \u0432\u044B\u0448\u0435\n\u2705 \u041D\u0430\u0439\u0434\u0438\u0442\u0435 \u041C\u0418\u041D\u0418\u041C\u0423\u041C " + targetAdditional + " \u043D\u043E\u0432\u044B\u0445 \u0445\u0430\u0440\u0430\u043A\u0442\u0435\u0440\u0438\u0441\u0442\u0438\u043A\n\u2705 \u0418\u0441\u043F\u043E\u043B\u044C\u0437\u0443\u0439\u0442\u0435 \u0420\u0410\u0417\u041D\u042B\u0415 \u0438\u0441\u0442\u043E\u0447\u043D\u0438\u043A\u0438 \u0434\u043B\u044F \u043F\u0440\u043E\u0432\u0435\u0440\u043A\u0438\n\u2705 \u041D\u0415 \u0434\u0443\u0431\u043B\u0438\u0440\u0443\u0439\u0442\u0435 \u0443\u0436\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u043D\u044B\u0435 \u0445\u0430\u0440\u0430\u043A\u0442\u0435\u0440\u0438\u0441\u0442\u0438\u043A\u0438\n\u2705 \u0421\u043E\u0431\u043B\u044E\u0434\u0430\u0439\u0442\u0435 \u0442\u0438\u043F\u044B \u0434\u0430\u043D\u043D\u044B\u0445 (number/string_with_units/string_only)\n\n\uD83C\uDFAF **\u0426\u0415\u041B\u042C:** \u041C\u0430\u043A\u0441\u0438\u043C\u0430\u043B\u044C\u043D\u043E \u0434\u043E\u0437\u0430\u043F\u043E\u043B\u043D\u0438\u0442\u044C \u043D\u0435\u0434\u043E\u0441\u0442\u0430\u044E\u0449\u0438\u0435 \u0445\u0430\u0440\u0430\u043A\u0442\u0435\u0440\u0438\u0441\u0442\u0438\u043A\u0438!";
    };
    /**
     * Форматирование характеристик для промпта
     */
    EnhancedGPT5PromptsService.prototype.formatCharacteristicsForPrompt = function (characteristics, limit) {
        var charsToShow = limit ? characteristics.slice(0, limit) : characteristics;
        return charsToShow.map(function (char, index) {
            var _a;
            var typeIcon = char.detectedType === 'pure_number' ? '🔢' :
                char.detectedType === 'string_with_units' ? '📏' : '📝';
            var line = index + 1 + ". **" + char.name + "** (ID: " + char.id + ")";
            line += "\n   " + typeIcon + " **\u0422\u0418\u041F: " + (((_a = char.detectedType) === null || _a === void 0 ? void 0 : _a.toUpperCase()) || 'STRING_ONLY') + "**";
            if (char.detectedType === 'pure_number') {
                line += " - \u0422\u041E\u041B\u042C\u041A\u041E \u0427\u0418\u0421\u041B\u041E \u0411\u0415\u0417 \u0415\u0414\u0418\u041D\u0418\u0426!";
            }
            else if (char.detectedType === 'string_with_units') {
                line += " - \u0427\u0418\u0421\u041B\u041E + \u0415\u0414\u0418\u041D\u0418\u0426\u042B \u0418\u0417\u041C\u0415\u0420\u0415\u041D\u0418\u042F!";
            }
            else {
                line += " - \u0422\u041E\u041B\u042C\u041A\u041E \u0422\u0415\u041A\u0421\u0422!";
            }
            if (char.values && char.values.length > 0) {
                var values = char.values.slice(0, 3).map(function (v) { return v.value || v; }).join(', ');
                line += "\n   \uD83C\uDFAF **\u0412\u043E\u0437\u043C\u043E\u0436\u043D\u044B\u0435 \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u044F:** " + values + (char.values.length > 3 ? '...' : '');
            }
            return line;
        }).join('\n\n') +
            (limit && characteristics.length > limit ? "\n\n... \u0438 \u0435\u0449\u0451 " + (characteristics.length - limit) + " \u0445\u0430\u0440\u0430\u043A\u0442\u0435\u0440\u0438\u0441\u0442\u0438\u043A. \u0417\u0410\u041F\u041E\u041B\u041D\u0418\u0422\u0415 \u041C\u0410\u041A\u0421\u0418\u041C\u0423\u041C!" : '');
    };
    /**
     * Форматирование недостающих характеристик
     */
    EnhancedGPT5PromptsService.prototype.formatMissingCharacteristics = function (missingChars) {
        return missingChars.slice(0, 20).map(function (char, index) {
            var _a;
            var typeIcon = char.detectedType === 'pure_number' ? '🔢' :
                char.detectedType === 'string_with_units' ? '📏' : '📝';
            return index + 1 + ". " + typeIcon + " **" + char.name + "** (ID: " + char.id + ") - " + (((_a = char.detectedType) === null || _a === void 0 ? void 0 : _a.toUpperCase()) || 'STRING');
        }).join('\n') +
            (missingChars.length > 20 ? "\n... \u0438 \u0435\u0449\u0451 " + (missingChars.length - 20) + " \u0445\u0430\u0440\u0430\u043A\u0442\u0435\u0440\u0438\u0441\u0442\u0438\u043A" : '');
    };
    /**
     * Генерация специализированных поисковых запросов
     */
    EnhancedGPT5PromptsService.prototype.generateSpecializedSearchQueries = function (productName, categoryName) {
        var productLower = productName.toLowerCase();
        var queries = [];
        if (productLower.includes('наушники')) {
            queries.push('12. наушники частота импеданс чувствительность стандарты', '13. наушники bluetooth время работы емкость аккумулятора', '14. наушники размеры вес материал корпуса');
        }
        else if (productLower.includes('кабель')) {
            queries.push('12. кабель usb type-c длина материал оплетка', '13. кабель мощность зарядки скорость передачи данных', '14. кабель разъемы совместимость сертификация');
        }
        else if (productLower.includes('зарядн')) {
            queries.push('12. зарядное устройство мощность напряжение ток', '13. адаптер питания размеры вес защита', '14. зарядка быстрая технологии совместимость');
        }
        else {
            queries.push("12. \"" + productName + "\" \u0440\u0430\u0437\u043C\u0435\u0440\u044B \u0433\u0430\u0431\u0430\u0440\u0438\u0442\u044B \u0432\u0435\u0441", "13. \"" + productName + "\" \u043C\u0430\u0442\u0435\u0440\u0438\u0430\u043B\u044B \u0438\u0437\u0433\u043E\u0442\u043E\u0432\u043B\u0435\u043D\u0438\u044F \u043A\u0430\u0447\u0435\u0441\u0442\u0432\u043E", "14. \"" + categoryName + "\" \u0442\u0440\u0435\u0431\u043E\u0432\u0430\u043D\u0438\u044F \u0445\u0430\u0440\u0430\u043A\u0442\u0435\u0440\u0438\u0441\u0442\u0438\u043A\u0438 \u0441\u0442\u0430\u043D\u0434\u0430\u0440\u0442\u044B");
        }
        return queries.join('\n');
    };
    /**
     * ПРОМПТ для анализа изображений с максимальным извлечением характеристик
     */
    EnhancedGPT5PromptsService.prototype.createImageAnalysisPrompt = function (context) {
        return "\u0412\u044B \u2014 GPT-5 \u042D\u041A\u0421\u041F\u0415\u0420\u0422 \u043F\u043E \u0432\u0438\u0437\u0443\u0430\u043B\u044C\u043D\u043E\u043C\u0443 \u0430\u043D\u0430\u043B\u0438\u0437\u0443 \u0442\u043E\u0432\u0430\u0440\u043E\u0432. \u0418\u0437\u0443\u0447\u0438\u0442\u0435 \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u044F \u0438 \u0438\u0437\u0432\u043B\u0435\u043A\u0438\u0442\u0435 \u041C\u0410\u041A\u0421\u0418\u041C\u0423\u041C \u0445\u0430\u0440\u0430\u043A\u0442\u0435\u0440\u0438\u0441\u0442\u0438\u043A.\n\n\uD83D\uDCF8 **\u0410\u041D\u0410\u041B\u0418\u0417 \u0418\u0417\u041E\u0411\u0420\u0410\u0416\u0415\u041D\u0418\u0419 - \u041D\u0410\u0419\u0414\u0418\u0422\u0415 \u0412\u0421\u0401:**\n\n\uD83D\uDD0D **\u041E\u0411\u042F\u0417\u0410\u0422\u0415\u041B\u042C\u041D\u041E \u0418\u0429\u0418\u0422\u0415:**\n1. **\u0422\u0435\u043A\u0441\u0442\u044B \u0438 \u043C\u0430\u0440\u043A\u0438\u0440\u043E\u0432\u043A\u0438:** \u043C\u043E\u0434\u0435\u043B\u044C, \u0430\u0440\u0442\u0438\u043A\u0443\u043B, \u0431\u0440\u0435\u043D\u0434, \u0442\u0435\u0445\u043D\u0438\u0447\u0435\u0441\u043A\u0438\u0435 \u043F\u0430\u0440\u0430\u043C\u0435\u0442\u0440\u044B\n2. **\u0420\u0430\u0437\u043C\u0435\u0440\u044B:** \u043B\u044E\u0431\u044B\u0435 \u0443\u043A\u0430\u0437\u0430\u043D\u0438\u044F \u043D\u0430 \u0440\u0430\u0437\u043C\u0435\u0440\u044B, \u043C\u0430\u0441\u0448\u0442\u0430\u0431, \u0441\u0440\u0430\u0432\u043D\u0435\u043D\u0438\u044F\n3. **\u041C\u0430\u0442\u0435\u0440\u0438\u0430\u043B\u044B:** \u0432\u0438\u0437\u0443\u0430\u043B\u044C\u043D\u0430\u044F \u043E\u0446\u0435\u043D\u043A\u0430 \u043C\u0430\u0442\u0435\u0440\u0438\u0430\u043B\u043E\u0432 (\u043F\u043B\u0430\u0441\u0442\u0438\u043A, \u043C\u0435\u0442\u0430\u043B\u043B, \u0442\u043A\u0430\u043D\u044C)\n4. **\u0426\u0432\u0435\u0442\u0430:** \u0442\u043E\u0447\u043D\u043E\u0435 \u043E\u043F\u0440\u0435\u0434\u0435\u043B\u0435\u043D\u0438\u0435 \u043E\u0441\u043D\u043E\u0432\u043D\u043E\u0433\u043E \u0438 \u0434\u043E\u043F\u043E\u043B\u043D\u0438\u0442\u0435\u043B\u044C\u043D\u044B\u0445 \u0446\u0432\u0435\u0442\u043E\u0432\n5. **\u0422\u0435\u0445\u043D\u0438\u0447\u0435\u0441\u043A\u0438\u0435 \u044D\u043B\u0435\u043C\u0435\u043D\u0442\u044B:** \u0440\u0430\u0437\u044A\u0435\u043C\u044B, \u043A\u043D\u043E\u043F\u043A\u0438, \u0438\u043D\u0434\u0438\u043A\u0430\u0442\u043E\u0440\u044B, \u043F\u0440\u043E\u0432\u043E\u0434\u0430\n6. **\u0423\u043F\u0430\u043A\u043E\u0432\u043A\u0430:** \u043B\u044E\u0431\u0430\u044F \u0438\u043D\u0444\u043E\u0440\u043C\u0430\u0446\u0438\u044F \u043D\u0430 \u043A\u043E\u0440\u043E\u0431\u043A\u0435, \u044D\u0442\u0438\u043A\u0435\u0442\u043A\u0430\u0445, \u0438\u043D\u0441\u0442\u0440\u0443\u043A\u0446\u0438\u044F\u0445\n7. **\u0421\u0440\u0430\u0432\u043D\u0435\u043D\u0438\u044F:** \u0435\u0441\u043B\u0438 \u0435\u0441\u0442\u044C \u043F\u0440\u0435\u0434\u043C\u0435\u0442\u044B \u0434\u043B\u044F \u043C\u0430\u0441\u0448\u0442\u0430\u0431\u0430 (\u043C\u043E\u043D\u0435\u0442\u044B, \u043B\u0438\u043D\u0435\u0439\u043A\u0438)\n\n\uD83D\uDCCB **\u0425\u0410\u0420\u0410\u041A\u0422\u0415\u0420\u0418\u0421\u0422\u0418\u041A\u0418 \u0414\u041B\u042F \u041F\u041E\u0418\u0421\u041A\u0410 \u041D\u0410 \u0418\u0417\u041E\u0411\u0420\u0410\u0416\u0415\u041D\u0418\u042F\u0425:**\n" + this.formatCharacteristicsForPrompt(context.characteristics, 30) + "\n\n\uD83D\uDCE4 **\u0418\u0417\u0412\u041B\u0415\u0427\u0401\u041D\u041D\u042B\u0415 \u0414\u0410\u041D\u041D\u042B\u0415:**\n{\n  \"visualAnalysis\": {\n    \"detectedTexts\": [\"\u0442\u0435\u043A\u0441\u0442 1\", \"\u0442\u0435\u043A\u0441\u0442 2\"],\n    \"detectedBrand\": \"\u043D\u0430\u0439\u0434\u0435\u043D\u043D\u044B\u0439 \u0431\u0440\u0435\u043D\u0434\",\n    \"detectedModel\": \"\u043D\u0430\u0439\u0434\u0435\u043D\u043D\u0430\u044F \u043C\u043E\u0434\u0435\u043B\u044C\", \n    \"colors\": [\"\u043E\u0441\u043D\u043E\u0432\u043D\u043E\u0439 \u0446\u0432\u0435\u0442\", \"\u0434\u043E\u043F\u043E\u043B\u043D\u0438\u0442\u0435\u043B\u044C\u043D\u044B\u0439\"],\n    \"materials\": [\"\u043C\u0430\u0442\u0435\u0440\u0438\u0430\u043B 1\", \"\u043C\u0430\u0442\u0435\u0440\u0438\u0430\u043B 2\"],\n    \"estimatedDimensions\": \"\u043F\u0440\u0438\u0431\u043B\u0438\u0437\u0438\u0442\u0435\u043B\u044C\u043D\u044B\u0435 \u0440\u0430\u0437\u043C\u0435\u0440\u044B\",\n    \"technicalElements\": [\"\u044D\u043B\u0435\u043C\u0435\u043D\u0442 1\", \"\u044D\u043B\u0435\u043C\u0435\u043D\u0442 2\"]\n  },\n  \"extractedCharacteristics\": [\n    {\n      \"id\": 85,\n      \"name\": \"\u0411\u0440\u0435\u043D\u0434\",\n      \"value\": \"\u043D\u0430\u0439\u0434\u0435\u043D\u043D\u044B\u0439 \u043D\u0430 \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0438\",\n      \"confidence\": 0.9,\n      \"source\": \"\u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0435\",\n      \"reasoning\": \"\u0447\u0435\u0442\u043A\u043E \u0432\u0438\u0434\u0435\u043D \u043B\u043E\u0433\u043E\u0442\u0438\u043F \u043D\u0430 \u0442\u043E\u0432\u0430\u0440\u0435\"\n    }\n  ]\n}\n\n\uD83C\uDFAF **\u0426\u0415\u041B\u042C:** \u0418\u0437\u0432\u043B\u0435\u0447\u044C \u043C\u0430\u043A\u0441\u0438\u043C\u0443\u043C \u0438\u043D\u0444\u043E\u0440\u043C\u0430\u0446\u0438\u0438 \u0438\u0437 \u0432\u0438\u0437\u0443\u0430\u043B\u044C\u043D\u043E\u0433\u043E \u0430\u043D\u0430\u043B\u0438\u0437\u0430!";
    };
    return EnhancedGPT5PromptsService;
}());
exports.EnhancedGPT5PromptsService = EnhancedGPT5PromptsService;
exports.enhancedGPT5PromptsService = new EnhancedGPT5PromptsService();
